{{/*<!--
  ~ The MIT License (MIT)
  ~
  ~ Copyright (c) 2016.  Georg Beier. All rights reserved.
  ~
  ~ Permission is hereby granted, free of charge, to any person obtaining a copy
  ~ of this software and associated documentation files (the "Software"), to deal
  ~ in the Software without restriction, including without limitation the rights
  ~ to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
  ~ copies of the Software, and to permit persons to whom the Software is
  ~ furnished to do so, subject to the following conditions:
  ~
  ~ The above copyright notice and this permission notice shall be included in all
  ~ copies or substantial portions of the Software.
  ~
  ~ THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  ~ IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  ~ FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
  ~ AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  ~ LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
  ~ OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
  ~ SOFTWARE.
  -->*/}}

{{define "work"}}
<html xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>DKFAI App</title>
    <link rel="stylesheet" type="text/css" href="../css/bootstrap.min.css">
    <!-- Optional Bootstrap theme -->
    <link rel="stylesheet" href="../css/bootstrap-theme.min.css">
    <script src="../js/jquery-3.1.1.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <script src="../js/validator.js"></script>
    <script src="../js/work.js"></script>
</head>
<body>
{{template "finder" .}}
<hr>
{{template "tabs" . }}
</body>
</html>
{{end}}

{{define "finder"}}
<div style="margin: 5px">
    <nav role="navigation" class="navbar navbar-default">
            <a href="/logout" class="navbar-brand navbar-right">
                <span class="sr-only">Logout</span>
                <span class="glyphicon glyphicon-off" style="margin-right: 5 px"></span>
                &nbsp;
            </a>
            <div class="navbar-header">
                <button type="button" data-target="#navbarCollapse" data-toggle="collapse" class="navbar-toggle">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
            </div>
            <div id="navbarCollapse" class="collapse navbar-collapse">
                <form role="search" class="navbar-form navbar-left">
                    {{template "csrf" . }}
                    <div class="form-group">
                        <input id="search1" type="text" placeholder="LastName" class="form-control" style="margin: 2px 0px;">
                        <input id="search2" type="text" placeholder="FirstName" class="form-control" style="margin: 2px 0px;">
                        <button id="find" type="button" class="btn btn-default" style="margin: 2px 0px;">
                            <span class="sr-only">Find</span>
                            <span class="glyphicon glyphicon-search"></span>
                        </button>
                        <div id="qapps" class="form-group" style="margin: 2px 0px;">
                            <select id="noresult" class="form-control" style="width: 16em;" disabled="disabled">
                                <option value="0">----------</option>
                            </select>
                        </div>
                    </div>
                </form>
                <script>
                    function prepare() {
                        $.ajax({
                            url: "getcsv",
                            type: "get",
                            success: function () {
                            var link = document.createElement('a');
                                link.setAttribute('href','/list/resultlist.csv');
                                link.setAttribute('download','resultlist.csv');
                                link.click();

                            }
                        })
                    }
                </script>
                <button onclick="prepare()">download</button>
        </div>
    </nav>
</div>
{{end}}

{{define "qresult"}}
<select id="sresult" class="form-control" style="width: 16em;" onchange="showSelect()">
    {{range .}}
    <option value="{{.id}}">{{.lastname}}, {{.firstname}}</option>
    {{else}}
    <option value="0">not found</option>
    {{end}}
</select>
{{end}}

{{define "tabs"}}
<ul class="nav nav-tabs" id="workTabs">
    {{if .authenrol}}
    <script type="text/javascript">
        // objects that cache the search result select values of every tab
        searchStates['enrol'] = new SearchState('#qapps', '#search1', '#search2');
        searchStates['edit'] = new SearchState('#qapps', '#search1', '#search2');
        searchStates['cancellation'] = new SearchState('#qapps', '#search1', '#search2');
        // information to configure the search click url and result area of every tab
        finderValues['enrol'] = {findUrl: '/find/applicant', targetUrl: '/enrol/show', target: '#enrolarea'};
        finderValues['edit'] = {findUrl: '/find/applicant', targetUrl: '/enrol/show', target: '#editarea'};
        finderValues['cancellation'] = {findUrl: '/find/applicant', targetUrl: '/cancellation/show', target: '#cancellationarea'};
    </script>
    <li class="active" data-toggle="tooltip" data-placement="top" title='{{i18n "_title_enrol" .language}}'>
        <a data-toggle="tab" href="#enrol"><span class="glyphicon glyphicon-education"></span> </a>
    </li>
    <li data-toggle="tooltip" data-placement="top" title='{{i18n "_title_edit_candidate" .language}}'>
        <a data-toggle="tab" href="#edit"><span class="glyphicon glyphicon-pencil"></span></a>
    </li>
    <li data-toggle="tooltip" data-placement="top" title='{{i18n "_title_cancel_candidate" .language}}'>
        <a data-toggle="tab" href="#cancellation"><span class="glyphicon glyphicon-remove-sign"></span></a>
    </li>
    {{end}}
    {{if .authpoff}}
    <script type="text/javascript">
        searchStates['results'] = new SearchState('#qapps', '#search1', '#search2');
        searchStates['resultlist'] = new SearchState('#qapps', '#search1', '#search2');
        finderValues['results'] = {findUrl: '/find/applicant', targetUrl: '/results/show', target: '#resultsarea'};
        finderValues['resultlist'] = {findUrl: '/find/applicant', targetUrl: '/enrol/resultlist', target: '#resultlistarea'};
    </script>
    <li data-toggle="tooltip" data-placement="top" title='{{i18n "_title_capture_results" .language}}'>
        <a data-toggle="tab" href="#results"><span class="glyphicon glyphicon-certificate"></span></a>
    </li>
    <li data-toggle="tooltip" data-placement="top" title='{{i18n "_title_result_list" .language}}'>
        <a data-toggle="tab" href="#resultlist"><span class="glyphicon glyphicon-th-list"></span></a>
    </li>
    {{end}}
    {{if .authuadmin}}
    <script type="text/javascript">
        searchStates['users'] = new SearchState('#qapps', '#search1', '#search2');
        finderValues['users'] = {findUrl: '/find/user', targetUrl: '/user/show', target: '#usersarea'}
    </script>
    <li data-toggle="tooltip" data-placement="top" title='{{i18n "_title_edit_users" .language}}'>
        <a data-toggle="tab" href="#users"><span class="glyphicon glyphicon-user"></span></a>
    </li>
    {{end}}
    {{if .authfulladmin}}

    <script type="text/javascript">
        searchStates['admin'] = new SearchState('#qapps', '#search1', '#search2');
        searchStates['trace'] = new SearchState('#qapps', '#search1', '#search2');
        finderValues['trace'] = {findUrl: '/find/applicant', targetUrl: '/updated/applicant', target: '#tracearea'}
    </script>

    <li data-toggle="tooltip" data-placement="top" title='{{i18n "_title_admin" .language}}'>
        <a data-toggle="tab" href="#admin"><span class="glyphicon glyphicon-wrench"></span></a>
    </li>
    <li data-toggle="tooltip" data-placement="top" title='{{i18n "_title_audit" .language}}'>
        <a data-toggle="tab" href="#trace"><span class="glyphicon glyphicon-eye-open"></span></a>
    </li>
    {{end}}
    {{if .authall}}
    <script type="text/javascript">
        searchStates['set'] = new SearchState('#qapps', '#search1', '#search2');
    </script>
    <li data-toggle="tooltip" data-placement="top" title='{{i18n "_title_profile" .language}}'>
        <a data-toggle="tab" href="#set"><span class="glyphicon glyphicon-cog"></span></a>
    </li>
    {{end}}
</ul>
<div class="tab-content">
    {{if .authenrol}}
    <div id="enrol" class="tab-pane fade in active">
        <div id="enrolarea" style="margin: 20px">
            <p></p>
        </div>
    </div>
    <div id="edit" class="tab-pane fade">
        <div id="editarea" style="margin: 20px">
            <p></p>
        </div>
    </div>
    <div id="cancellation" class="tab-pane fade">
        <div class="radio-inline">
            <label for="do-cancellation" class="control-label">
                <input id="do-cancellation" type="radio" name="cancellation" value="" checked="checked">
                {{i18n "_cancellation" .language}}
            </label>
        </div>
        <div class="radio-inline">
            <label for="undo-cancellation" class="control-label">
                <input id="undo-cancellation" type="radio" name="cancellation" value="undo">
                {{i18n "_undo_cancellation" .language}}
            </label>
        </div>
        <div id="cancellationarea" style="margin: 20px">
            <p></p>
        </div>
    </div>
    {{end}}
    {{if .authpoff}}
    <div id="results" class="tab-pane fade">
        <div id="resultsarea" style="margin: 20px">
            <p></p>
        </div>
    </div>
    <div id="resultlist" class="tab-pane fade">
        <div id="resultlistarea" style="margin: 20px">
            <p></p>
        </div>
    </div>
    {{end}}
    {{if .authuadmin}}
    <div id="users" class="tab-pane fade">
        <div id="usersarea" style="margin: 20px">
            <p></p>
        </div>
    </div>
    {{end}}
    {{if .authfulladmin}}
    <div id="admin" class="tab-pane fade">
        <div id="adminarea" style="margin: 20px">
            <p>
            <script>
                var empty;
                var l;
                var nquestion;
                function gosub() {
                    $('#examform').submit;
                    document.getElementById('year').disabled = false;
                    for (i=1;i<1000;i++){
                        $('#ttt'+i).hide();
                    }
                }
                function newtask() {
                    n=l-empty;
                    if(empty>0){
                        $("<div class='col-sm-2' ><label for='task"+
                            n+"'>Task"+n+": </label><input class='form-control' id='task"+
                            n+"' placeholder='Task "+n+"' name='task"+n+"'></div><div class='clearfix'></div>").insertBefore('#task0');
                        empty--;
                    }
                    if (empty<=0){
                        $('#newtask').hide();
                    }
                }
                function gettest() {
                    yeah = $('#year').val();

                    $.ajax({
                        type: "get",
                        url: "gettasks",
                        dataType: "json",
                        data: {"year": yeah},
                        success: function (result) {
                            document.getElementById('year').disabled = true;
                            nquestion = result[0];
                            l = result.length;
                            empty = 0;
                            for (i=l-1;i>0;i--){if(result[i]>0){break;}empty++;}
                            for (i=1;i<l-empty;i++){
                                $("<div id='ttt"+i+"' class='col-sm-2' ><label for='task"+
                                        i+"'>Task"+i+": </label><input class='form-control' id='task"+
                                        i+"' value='"+result[i]+"' name='task"+i+"'></div><div class='clearfix'></div>").insertBefore('#task0');
                            }
                            if (empty>0){
                                $('#newtask').show();
                            }
                            document.getElementById('submit').disabled = false;
                        }
                    })
                }
            </script>
                <form role="form" id="examform" method="post" class="form-horizontal" action="examref">
                    <div class="form-group">
                        <div class="row">
                        <div class="col-sm-2">
                            <label for="year">Year: </label>
                            <select id="year" name="year" class="form-control" onchange="gettest()">
                                <option >----------------</option>
                                <option value="2017">2017</option>
                                <option value="2018">2018</option>
                                <option value="2019">2019</option>
                                <option value="2020">2020</option>
                                <option value="2021">2021</option>
                                <option value="2022">2022</option>
                                <option value="2023">2023</option>
                                <option value="2024">2024</option>
                                <option value="2025">2025</option>
                                <option value="2026">2026</option>
                            </select>
                        </div>
                            <div class="col-sm-3" style="margin-top: 30px"><button id="submit" onclick="gosub()" disabled>Submit</button></div>
                    </div>
                    </div>
            <div class="clearfix"></div>
                    <div class="form-group">
                        <div id="task0"></div>

                    </div>
                </form>
            <br>
            <div class="col-sm-3 col-md-4" id="newtask" style="display: none">
                <button onclick="newtask()">Add New Task</button>
            </div>

            </p>
        </div>
    </div>
    <div id="trace" class="tab-pane fade">
        <div id="tracearea" style="margin: 20px">
            <p></p>
        </div>
    </div>
    {{end}}
    {{if .authall}}
    <div id="set" class="tab-pane fade">
        <script type="text/javascript">
            $(document).ready(function () {
               $('#changepass').click(function () {
                   $('#onchangepass').show();
                   $('#onchangename').hide();
                   $('#fullname').val("");
               });
                $('#changename').click(function () {
                    $('#onchangename').show();
                    $('#onchangepass').hide();
                    $('#pass').val("");
                    $('#verify').val("");
                    document.getElementById('passmess').style.color = '#3c763d';
                });
            });
            function checkUpdate(login) {
                small = false
                big = false
                numb = false
                sim = false
                password = $('#pass').val();
                verify = $('#verify').val();
                len = password.length
                for (i=0;i<len;i++){
                    q = password.charCodeAt(i)
                    if (q>64 && q<91)big = true
                    else if (q>96 && q<123)small = true
                    else if (q>47 && q<58)numb = true
                    else sim = true
                }
                if (len>7 && big && small && numb && sim){
                if (password==verify){
                    $.ajax({
                        url: "passupdate",
                        data: {"login": login, "password": password},
                        type: "get",
                        success: function () {
                            document.getElementById('passmess').innerHTML = "Пароль успешно изменен.";
                            document.getElementById('passmess').style.color = '#3c763d';
                            $('#pass').val("");
                            $('#verify').val("");
                            change('none');
                        }
                    })

                }
                else {
                    document.getElementById('passmess').style.color = "Red";
                }
                }
                else {
                    document.getElementById('passmess').style.color = "Red";
                }
            }
            function setname(login) {
                var fullname = $('#fullname').val();
                $.ajax({
                    type : "get",
                    url : "changefullname",
                    data : {"fullname": fullname, "login": login},
                    success : function (result) {
                        document.getElementById('name').innerHTML = result;
                        $('#fullname').val("");
                    }
                })
            }
        </script>
        <div id="setadminarea" style="margin: 20px">
            <p>
                FullName : <p id="name">{{ .user.Fullname }}</p>
                <br>
                Login : {{ .user.Login }}
            <br>
            <div class="radio-inline">
                <label for="changepass" class="control-label">
                    <input id="changepass" type="radio" name="updateconf">
                    Change Password
                </label>
            </div>
            <div class="radio-inline">
                <label for="changename" class="control-label">
                    <input id="changename" type="radio" name="updateconf">
                    Change Fullname
                </label>
            </div>
                <div id="onchangepass" style="display: none">
                 <form role="form" >
                     <div class="form-group">
                         <div class="col-sm-3">
                             <p id="passmess" style="color: #3c763d">Пароль должен иметь более 7 символов, обязательно иметь одну или несколько больших латынских букв,
                                 одну или несколько маленьких латынских букв, одну или несколько цифр,
                                 одну или несколько символических знаков и обязательно должен совпадать с проверкой.</p>
                         </div>
                         <div class="clearfix"></div>
                         <div class="col-sm-3">
                            <label for="pass">Password: </label>
                            <input class="form-control" type="password" name="password" id="pass">
                         </div>
                         <div class="clearfix"></div>
                         <div class="col-sm-3">
                            <label for="verify">Verify: </label>
                            <input class="form-control" type="password" name="verify" id="verify"><div id="inc"></div>
                         </div>
                     </div>
                     <div class="clearfix"></div>
                 </form>
                    <div class="col-sm-1">
                        <button class="form-control" onclick="checkUpdate('{{ .user.Login }}')" >Submit</button>
                    </div>
                </div>
            <div id="onchangename" style="display: none">
                <form role="form" >
                    <div class="form-group">
                        <div class="col-sm-3">
                            <label for="pass">Fullname: </label>
                            <input class="form-control" type="text" name="fullname" id="fullname" >
                        </div>
                    </div>
                    <div class="clearfix"></div>
                </form>
                <div class="col-sm-1">
                    <button class="form-control" onclick="setname('{{ .user.Login }}')" >Submit</button>
                </div>
            </div>
            </p>
        </div>
    </div>
    {{end}}
</div>
{{end}}
